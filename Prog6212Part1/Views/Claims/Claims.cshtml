@model Prog6212Part1.Models.Claims

@{
    ViewData["Title"] = "Submit Claim";
}

<div class="container mt-5">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Submit a Lecturer Claim</h4>
        </div>
        <div class="card-body px-4 py-5">
            <form asp-action="Claims" method="post" enctype="multipart/form-data" id="claimsForm">

                <!-- Lecturer Info -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2 mb-3">Lecturer Information</h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label asp-for="LecturerID" class="form-label">Lecturer ID</label>
                            <input asp-for="LecturerID" class="form-control" required />
                            <span asp-validation-for="LecturerID" class="text-danger small"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="FirstName" class="form-label">First Name</label>
                            <input asp-for="FirstName" class="form-control" required />
                            <span asp-validation-for="FirstName" class="text-danger small"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="LastName" class="form-label">Last Name</label>
                            <input asp-for="LastName" class="form-control" required />
                            <span asp-validation-for="LastName" class="text-danger small"></span>
                        </div>
                    </div>
                </div>

                <!-- Claim Period -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2 mb-3">Claim Period</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label asp-for="ClaimsPeriodsStart" class="form-label">Start Date</label>
                            <input asp-for="ClaimsPeriodsStart" type="date" class="form-control" required />
                            <span asp-validation-for="ClaimsPeriodsStart" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="ClaimsPeriodsEnd" class="form-label">End Date</label>
                            <input asp-for="ClaimsPeriodsEnd" type="date" class="form-control" required />
                            <span asp-validation-for="ClaimsPeriodsEnd" class="text-danger small"></span>
                        </div>
                    </div>
                </div>

                <!-- Work & Payment Details -->
                <div class="mb-4">
                    <h5 class="border-bottom pb-2 mb-3">Work & Payment Details</h5>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label asp-for="HoursWorked" class="form-label">Hours Worked</label>
                            <input asp-for="HoursWorked" class="form-control" id="hoursWorked" required />
                            <span asp-validation-for="HoursWorked" class="text-danger small"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="RateHour" class="form-label">Rate per Hour (R)</label>
                            <input asp-for="RateHour" class="form-control" id="ratePerHour" required />
                            <span asp-validation-for="RateHour" class="text-danger small"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="DescriptionOfWork" class="form-label">Work Description</label>
                            <input asp-for="DescriptionOfWork" class="form-control" />
                        </div>
                    </div>
                </div>

                <!-- File Upload -->
                <div class="mb-4">
                    <label asp-for="SupportingDocuments" class="form-label">Supporting Documents</label>
                    <input asp-for="SupportingDocuments" type="file" multiple class="form-control" />
                </div>

                <!-- Submit Button -->
                <div class="d-grid">
                    <button type="submit" class="btn btn-success btn-lg">Submit Claim</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <script>
        $(document).ready(function () {
            $('#claimsForm').on('submit', function (event) {
                event.preventDefault();
                toastr.clear();

                let isValid = true;
                $('#claimsForm input[required]').each(function () {
                    if ($(this).val() === '') {
                        isValid = false;
                        return false;
                    }
                });

                if (!isValid) {
                    toastr.error('Please fill in all required fields.', 'Form Error');
                    return;
                }

                const hoursWorked = parseFloat($('#hoursWorked').val()) || 0;
                const ratePerHour = parseFloat($('#ratePerHour').val()) || 0;
                const totalAmount = hoursWorked * ratePerHour;

                toastr.success('Total amount: R' + totalAmount.toFixed(2), 'Amount Calculated');

                setTimeout(function () {
                    toastr.success('Claim submitted successfully!', 'Success');
                    setTimeout(function () {
                        $('#claimsForm')[0].submit();
                    }, 1000);
                }, 1000);
            });
        });
    </script>
}
